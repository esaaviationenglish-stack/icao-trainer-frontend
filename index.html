<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ICAO Trainer Cockpit</title>
</head>
<body>
<h1>ICAO Trainer Cockpit</h1>

<button id="startBtn">Start Recording</button>
<button id="stopBtn">Stop Recording</button>
<p>Trascrizione: <span id="transcript"></span></p>
<p>Feedback: <span id="feedback"></span></p>
<p>ATC Message: <span id="atcMessage"></span></p>

<script>
  // ----------------------------
  // URL del backend giÃ  impostato
  const BACKEND_URL = "https://icao-trainer-backend.vercel.app";
  // ----------------------------

  let mediaRecorder;
  let audioChunks = [];

  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const transcriptEl = document.getElementById('transcript');
  const feedbackEl = document.getElementById('feedback');
  const atcEl = document.getElementById('atcMessage');

  startBtn.onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.start();
  };

  stopBtn.onclick = async () => {
    mediaRecorder.stop();
    mediaRecorder.onstop = async () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const formData = new FormData();
      formData.append('file', audioBlob);

      // Invia audio al backend
      const res = await fetch(`${BACKEND_URL}/api/audio`, {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      transcriptEl.textContent = data.transcript;
      feedbackEl.textContent = data.feedback;
      atcEl.textContent = data.atc_message;

      // TTS semplice
      const utter = new SpeechSynthesisUtterance(data.atc_message);
      window.speechSynthesis.speak(utter);
    };
  };
</script>

</body>
</html>

